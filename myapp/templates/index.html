{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CMS — Complaint Management System</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b1020;--card:#121a33;--muted:#9aa4bf;--text:#eaf0ff;--brand:#3b82f6;--brand-2:#22d3ee;--accent:#f59e0b;--ring:rgba(59,130,246,.35);--ok:#10b981;--danger:#ef4444;--shadow:0 10px 25px rgba(0,0,0,.35);--radius:18px;}
    *{box-sizing:border-box}html,body{height:100%}body{margin:0;padding-top:72px;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(1200px 600px at 20% -10%,rgba(34,211,238,.25),transparent 60%),radial-gradient(900px 500px at 90% 10%,rgba(59,130,246,.25),transparent 60%),var(--bg);color:var(--text);line-height:1.6;}
    /* Header */
    .nav{
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      backdrop-filter: saturate(160%) blur(8px);
      -webkit-backdrop-filter: saturate(160%) blur(8px); /* For Safari support */
      background: linear-gradient(180deg, rgba(11,16,32,.95), rgba(11,16,32,.85));
      border-bottom: 1px solid rgba(255,255,255,.06);
      transition: all 0.3s ease;
      will-change: transform;
      width: 100%;
      box-sizing: border-box;
    }
    .wrap{max-width:1200px;margin:0 auto;padding:0 20px}
    .nav__inner{display:flex;align-items:center;justify-content:space-between;height:72px;}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text)}
    .logo{
      width:38px;height:38px;border-radius:12px;
      background: conic-gradient(from 210deg, var(--brand), var(--brand-2), var(--brand));
      box-shadow: 0 6px 18px rgba(34,211,238,.35);
    }
    .brand span{font-weight:800;letter-spacing:.2px}
    .nav__inner{display:flex;align-items:center;justify-content:space-between}
    .nav__links{display:flex;gap:26px;align-items:center}
    .nav__links a{color:var(--muted);text-decoration:none;font-weight:600}
    .nav__links a:hover{color:#fff}
    .nav__auth{display:flex;gap:12px;align-items:center}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;
      height:46px;padding:0 18px;border:none;border-radius:14px;
      background: linear-gradient(90deg, var(--brand), var(--brand-2));
      color:#031026;font-weight:800;cursor:pointer;box-shadow: var(--shadow);
      transition: all 0.2s ease;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }
    .btn:active {
      transform: translateY(0);
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.6);
      background: linear-gradient(90deg, #2563eb, #0891b2);
    }
    .btn:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3), 0 4px 15px rgba(59, 130, 246, 0.6);
    }
    .btn--ghost{
      background:transparent;
      border:1px solid rgba(255,255,255,.15);
      color:#fff;
      transition: all 0.2s ease;
    }
    .btn--ghost:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
    }
    .btn--ghost:active {
      transform: translateY(0);
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.4);
    }
    .btn--ghost:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
    }
    .btn--small{height:36px;padding:0 14px;font-size:0.9rem}
    .hamburger{display:none;background:none;border:none;color:#fff;font-size:28px}
    /* Hero */
    .hero{padding:72px 0 48px}
    .hero__grid{display:grid;grid-template-columns:1.2fr 1fr;gap:28px;align-items:center}
    .kicker{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(34,211,238,.15);color:#b7f9ff;font-weight:700;font-size:.85rem}
    h1{font-size:clamp(2rem,5vw,3.5rem);line-height:1.12;margin:.6rem 0}
    .lead{color:#c6d0ea;max-width:60ch}
    .hero__cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:20px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .screen{aspect-ratio:16/10}
    .screen__inner{height:100%;padding:18px}
    .screen__window{
      height:100%;border-radius:14px;background:
      linear-gradient(120deg, rgba(59,130,246,.15), rgba(34,211,238,.08));
      border:1px solid rgba(255,255,255,.08);position:relative;overflow:hidden;
    }
    .pulse{
      position:absolute;inset:auto 24px 24px auto;padding:6px 10px;border-radius:10px;
      background:#071226;color:#b9d8ff;border:1px solid rgba(59,130,246,.35);
      animation:float 6s ease-in-out infinite;
    }
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
    /* Features */
    .section{padding:72px 0}
    .center{text-align:center}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-top:28px}
    .feature{padding:22px}
    .feature h3{margin:6px 0 8px}
    .icon{
      width:42px;height:42px;border-radius:12px;
      display:grid;place-items:center;
      background:linear-gradient(180deg, rgba(34,211,238,.2), rgba(59,130,246,.15));
      border:1px solid rgba(255,255,255,.08)
    }
    .muted{color:var(--muted)}
    /* Steps */
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:24px;align-items:center}
    .list{display:grid;gap:12px;margin-top:10px}
    .list .row{display:flex;gap:12px;align-items:flex-start}
    .badge{
      min-width:28px;height:28px;border-radius:999px;display:grid;place-items:center;
      background:rgba(59,130,246,.2);color:#cfe2ff;font-weight:700;border:1px solid rgba(59,130,246,.35)
    }
    /* Testimonials */
    .marquee{
      display:flex;gap:18px;overflow:hidden;mask-image: linear-gradient(90deg, transparent, #000 10%, #000 90%, transparent);
    }
    .marquee .quote{min-width:320px;max-width:420px;padding:18px}
    .quote small{color:var(--muted)}
    .stars{color:#ffd166}
    /* Pricing */
    .pricing{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
    .priceCard{padding:22px;position:relative;overflow:hidden}
    .price{font-size:2rem;font-weight:800}
    .chip{position:absolute;top:14px;right:14px;background:rgba(16,185,129,.2);border:1px solid rgba(16,185,129,.45);color:#bdfbe1;padding:4px 10px;border-radius:999px;font-size:.8rem;font-weight:700}
    /* FAQ */
    .faq{max-width:900px;margin:0 auto}
    .faq details{
      margin:10px 0;padding:16px;border-radius:14px; border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.03)
    }
    .faq summary{cursor:pointer;font-weight:700}
    /* CTA Footer */
    .cta{display:grid;grid-template-columns:1.2fr 1fr;gap:20px;align-items:center}
    .footer{
      padding:36px 0; color:var(--muted); font-size:.95rem;border-top:1px solid rgba(255,255,255,.06)
    }
    .links{display:flex;gap:18px;flex-wrap:wrap}
    /* Utilities */
    .hidden{display:none}
    /* Responsive */
    @media (max-width: 980px){
      .hero__grid,.grid-2,.cta{grid-template-columns:1fr}
      .grid-3,.pricing{grid-template-columns:1fr}
      .nav__links,.nav__auth{display:none}
      .hamburger{display:block}
      .mobile{position:absolute;left:0;right:0;top:72px;background:#0b1226;padding:14px;border-bottom:1px solid rgba(255,255,255,.08)}
      .mobile a{display:block;padding:10px 0;color:#d8e1ff;text-decoration:none;border-bottom:1px dashed rgba(255,255,255,.08)}
      .mobile .btn{width:100%;margin-top:10px}
    }
    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    .modal.show {
      opacity: 1;
      visibility: visible;
    }
    .modal.hidden {
      display: none;
    }
    .modal-content {
      background: var(--card);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius);
      padding: 0;
      width: 90%;
      max-width: 400px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow);
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    .modal.show .modal-content {
      transform: scale(1);
    }
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 24px 24px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }
    .modal-header h2 {
      margin: 0;
      color: var(--text);
      font-size: 1.5rem;
      font-weight: 700;
    }
    .modal-close {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 28px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    .modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
    }
    .modal-form {
      padding: 0 24px 24px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text);
      font-weight: 600;
      font-size: 0.9rem;
    }
    .form-group input {
      width: 100%;
      height: 46px;
      padding: 0 16px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      background: rgba(11, 18, 38, 0.8);
      color: var(--text);
      font-size: 1rem;
      transition: all 0.2s ease;
    }
    .form-group input:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }
    .form-options {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 12px;
    }
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 0.9rem;
      cursor: pointer;
    }
    .checkbox-label input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
    }
    .forgot-link, .terms-link {
      color: var(--brand);
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.2s ease;
    }
    .forgot-link:hover, .terms-link:hover {
      color: var(--brand-2);
    }
    .btn--full {
      width: 100%;
      margin-bottom: 20px;
    }
    .modal-switch {
      text-align: center;
      color: var(--muted);
      font-size: 0.9rem;
      margin: 0;
    }
    .modal-switch a {
      color: var(--brand);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s ease;
    }
    .modal-switch a:hover {
      color: var(--brand-2);
    }
    /* OTP Verification Styles */
    .otp-header {
      text-align: center;
      margin-bottom: 24px;
    }
    .otp-header h3 {
      margin: 0 0 8px 0;
      color: #fff;
      font-size: 1.25rem;
    }
    .otp-header p {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
    }
    #otpEmailDisplay {
      color: #fff;
      font-weight: 600;
    }
    .otp-actions {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }
    .otp-actions .btn {
      flex: 1;
      font-size: 0.85rem;
    }
    .otp-timer {
      text-align: center;
      margin-top: 16px;
      color: var(--muted);
      font-size: 0.85rem;
    }
    #otpCode {
      text-align: center;
      font-size: 1.2rem;
      letter-spacing: 2px;
      font-family: monospace;
    }
    /* Login OTP specific styles */
    #loginOtpCode {
      text-align: center;
      font-size: 1.2rem;
      letter-spacing: 2px;
      font-family: monospace;
    }
    #loginOtpEmailDisplay {
      color: #fff;
      font-weight: 600;
    }
    /* Modal responsive */
    @media (max-width: 480px) {
      .modal-content {
        width: 95%;
        margin: 20px;
      }
      .modal-header {
        padding: 20px 20px 0;
      }
      .modal-form {
        padding: 0 20px 20px;
      }
    }
    /* Notification Modal Styles */
    .notification-content {
      max-width: 450px;
      padding: 0;
    }
    .notification-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 24px 24px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }
    .notification-icon {
      font-size: 2rem;
      margin-right: 16px;
    }
    .notification-header h3 {
      margin: 0;
      color: var(--text);
      font-size: 1.3rem;
      font-weight: 700;
      flex: 1;
    }
    .notification-body {
      padding: 0 24px 20px;
    }
    .notification-body p {
      margin: 0;
      color: var(--muted);
      font-size: 1rem;
      line-height: 1.5;
      text-align: center;
    }
    .notification-actions {
      padding: 0 24px 24px;
    }
    .notification-actions .btn {
      margin-top: 0;
    }
    /* Modal responsive */
    @media (max-width: 480px) {
      .otp-actions {
        flex-direction: column;
      }
    }
    /* Role Toggle Styles */
    .role-toggle {
      padding: 0 24px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }
    .toggle-container {
      display: flex;
      background: rgba(11, 18, 38, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      padding: 4px;
      gap: 4px;
    }
    .toggle-btn {
      flex: 1;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: transparent;
      color: var(--muted);
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .toggle-btn.active {
      background: linear-gradient(90deg, var(--brand), var(--brand-2));
      color: #031026;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }
    .toggle-btn:hover:not(.active) {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
    }
    .toggle-btn:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
    }
    /* Admin Message Styles */
    #adminMessage p {
      color: var(--muted);
      font-size: 0.9rem;
      margin: 0;
      padding: 12px;
      background: rgba(59, 130, 246, 0.1);
      border-radius: 8px;
      border-left: 3px solid var(--brand);
      line-height: 1.5;
    }
    /* Admin Access Key Field Styles */
    #adminAccessKey {
      font-family: 'Courier New', monospace;
      letter-spacing: 2px;
      text-align: center;
      font-weight: 600;
    }
    /* Input with button layout */
    .input-with-button {
      display: flex;
      gap: 8px;
      align-items: stretch;
    }
    .input-with-button input {
      flex: 1;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
    .input-with-button .btn {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      white-space: nowrap;
      min-width: 80px;
    }
    .form-help {
      display: block;
      margin-top: 4px;
      color: var(--muted);
      font-size: 0.8rem;
      line-height: 1.4;
    }
  </style>
</head>
<body>
<header class="nav">
  <div class="wrap nav__inner">
    <a class="brand" href="#top" aria-label="CMS Home"><div class="logo" aria-hidden="true"></div><span>CMS</span></a>
         <nav class="nav__links" aria-label="Main">
       <a href="#features">Features</a><a href="#how">How it works</a><a href="#faq">FAQ</a><button class="btn btn--ghost" onclick="scrollToId('contact')">Contact</button>
     </nav>
    <div class="nav__auth">
      <button class="btn btn--ghost btn--small" onclick="openModal('loginModal')" style="background:transparent;border:1px solid rgba(255,255,255,.15);color:#fff;">Login</button>
      <button class="btn btn--small" onclick="openModal('signupModal')" style="background:linear-gradient(90deg,var(--brand),var(--brand-2));color:#031026;">Sign Up</button>
    </div>
    <button class="hamburger" aria-label="Menu" id="menuBtn">☰</button>
  </div>
     <div class="mobile hidden" id="mobileMenu">
     <a href="#features" onclick="toggleMenu(false)">Features</a><a href="#how" onclick="toggleMenu(false)">How it works</a><a href="#faq" onclick="toggleMenu(false)">FAQ</a><button class="btn btn--ghost" onclick="scrollToId('contact');toggleMenu(false)">Contact</button><button class="btn btn--ghost" onclick="openModal('loginModal');toggleMenu(false)" style="background:transparent;border:1px solid rgba(255,255,255,.15);color:#fff;">Login</button><button class="btn" onclick="openModal('signupModal');toggleMenu(false)" style="background:linear-gradient(90deg,var(--brand),var(--brand-2));color:#031026;">Sign Up</button>
   </div>
</header>
<!-- Modals -->
<!-- Login Modal -->
<div id="loginModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Login</h2>
      <button class="modal-close" onclick="closeModal('loginModal')">&times;</button>
    </div>
    <!-- Role Toggle -->
    <div class="role-toggle">
      <div class="toggle-container">
        <button class="toggle-btn active" data-role="user" onclick="toggleRole('user', 'login')">User</button>
        <button class="toggle-btn" data-role="admin" onclick="toggleRole('admin', 'login')">Admin</button>
      </div>
    </div>
    <!-- Step 1: Initial Login Form -->
    <form class="modal-form" id="loginForm">
      <div class="form-group">
        <label for="loginEmail">Email</label>
        <input type="email" id="loginEmail" name="email" required>
      </div>
      <div class="form-group">
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" name="password" required>
      </div>

      <div class="form-options">
        <label class="checkbox-label">
          <input type="checkbox" name="remember">
          <span>Remember me</span>
        </label>
        <a href="#" class="forgot-link">Forgot password?</a>
      </div>
      <button type="submit" class="btn btn--full">Send Verification Code</button>
      <p class="modal-switch">
        Don't have an account?
        <a href="#" onclick="switchModal('loginModal', 'signupModal')">Sign up</a>
      </p>
    </form>
    <!-- Step 2: Login OTP Verification Form -->
    <form class="modal-form hidden" id="loginOtpForm">
      <div class="otp-header">
        <h3>Verify Your Email</h3>
        <p>We've sent a 6-digit verification code to <span id="loginOtpEmailDisplay"></span></p>
      </div>
      <div class="form-group">
        <label for="loginOtpCode">Verification Code</label>
        <input type="text" id="loginOtpCode" name="otp" maxlength="6" placeholder="Enter 6-digit code" required>
      </div>
      <div class="otp-actions">
        <button type="button" class="btn btn--ghost" onclick="resendLoginOTP()">Resend Code</button>
        <button type="button" class="btn btn--ghost" onclick="changeLoginEmail()">Change Email</button>
      </div>
      <button type="submit" class="btn btn--full">Verify & Login</button>
      <p class="otp-timer">Resend available in <span id="loginResendTimer">60</span>s</p>
    </form>
  </div>
</div>
<!-- Signup Modal -->
<div id="signupModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Sign Up</h2>
      <button class="modal-close" onclick="closeModal('signupModal')">&times;</button>
    </div>
    <!-- Role Toggle -->
    <div class="role-toggle">
      <div class="toggle-container">
        <button class="toggle-btn active" data-role="user" onclick="toggleRole('user', 'signup')">User</button>
        <button class="toggle-btn" data-role="admin" onclick="toggleRole('admin', 'signup')">Admin</button>
      </div>
    </div>
    <!-- Step 1: Initial Signup Form -->
    <form class="modal-form" id="signupForm">
      <div class="form-group">
        <label for="signupName">Full Name</label>
        <input type="text" id="signupName" name="name" required>
      </div>
      <div class="form-group">
        <label for="signupEmail">Email</label>
        <input type="email" id="signupEmail" name="email" required>
      </div>
      <div class="form-group">
        <label for="signupBarangay">Barangay</label>
        <div class="input-with-button">
          <input type="text" id="signupBarangay" name="barangay" required>
          <button type="button" class="btn btn--ghost btn--small" onclick="locateBarangay()" id="locateBarangayBtn">
            <span id="locateBtnText">📍 Locate</span>
          </button>
        </div>
        <small class="form-help">Click "Locate" to automatically detect your barangay using GPS</small>
      </div>
      <div class="form-group">
        <label for="signupPassword">Password</label>
        <input type="password" id="signupPassword" name="password" required>
      </div>
      <div class="form-group">
        <label for="signupConfirmPassword">Confirm Password</label>
        <input type="password" id="signupConfirmPassword" name="confirmPassword" required>
      </div>
      <div class="form-options">
        <label class="checkbox-label">
          <input type="checkbox" name="terms" required>
          <span>I agree to the <a href="#" class="terms-link">Terms of Service</a></span>
        </label>
      </div>
      <button type="submit" class="btn btn--full">Send Verification Code</button>
      <p class="modal-switch">
        Already have an account?
        <a href="#" onclick="switchModal('signupModal', 'loginModal')">Login</a>
      </p>
    </form>
    <!-- Step 2: OTP Verification Form -->
    <form class="modal-form hidden" id="otpForm">
      <div class="otp-header">
        <h3>Verify Your Email</h3>
        <p>We've sent a 6-digit verification code to <span id="otpEmailDisplay"></span></p>
      </div>
      <div class="form-group">
        <label for="otpCode">Verification Code</label>
        <input type="text" id="otpCode" name="otp" maxlength="6" placeholder="Enter 6-digit code" required>
      </div>
      <div class="otp-actions">
        <button type="button" class="btn btn--ghost" onclick="resendOTP()">Resend Code</button>
        <button type="button" class="btn btn--ghost" onclick="changeEmail()">Change Email</button>
      </div>
      <button type="submit" class="btn btn--full">Verify & Create Account</button>
      <p class="otp-timer">Resend available in <span id="resendTimer">60</span>s</p>
    </form>
  </div>
</div>
<!-- Custom Notification Modal -->
<div id="notificationModal" class="modal hidden">
  <div class="modal-content notification-content">
    <div class="notification-header">
      <div class="notification-icon" id="notificationIcon">✅</div>
      <h3 id="notificationTitle">Success</h3>
      <button class="modal-close" onclick="closeNotification()">&times;</button>
    </div>
    <div class="notification-body">
      <p id="notificationMessage">Operation completed successfully.</p>
    </div>
    <div class="notification-actions">
      <button class="btn btn--full" onclick="closeNotification()">OK</button>
    </div>
  </div>
</div>
<!-- Hero -->
<main id="top" class="wrap hero">
  <div class="hero__grid">
    <div>
      <span class="kicker">Barangay-ready • Secure • Fast</span>
      <h1>Report, Track, Resolve—<br/>All in one place.</h1>
      <p class="lead">
        The Complaint Management System helps residents submit reports in seconds, while giving local offices a crystal‑clear view of every case from intake to resolution.
      </p>
             <div class="hero__cta">
       </div>
      <p class="muted" style="margin-top:10px">No credit card · Works on any device · 24/7</p>
    </div>
    <div class="card screen">
      <div class="screen__inner">
        <div class="screen__window">
          <!-- Lightweight fake UI -->
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;padding:18px;">
            <img class="card" src="{% static 'images/pic1.jpg' %}" alt="picture diri" style="height:140px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,.08)">
            <img class="card" src="{% static 'images/pic2.jpg' %}" alt="picture diri" style="height:140px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,.08)">
            <img class="card" src="{% static 'images/pic3.jpg' %}" alt="picture diri" style="height:140px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,.08)">
            <img class="card" src="{% static 'images/pic4.jpg' %}" alt="picture diri" style="height:140px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,.08)">
          </div>
          <span class="pulse">Live updates • 3 new reports</span>
        </div>
      </div>
    </div>
  </div>
</main>
<!-- Features -->
<section id="features" class="wrap section">
  <div class="center">
    <span class="kicker">Why CMS</span>
    <h2 style="margin:.5rem 0 0">Everything you need to handle complaints—fast.</h2>
    <p class="muted">From intake to closure with transparency and auditability.</p>
  </div>
  <div class="grid-3">
    <article class="card feature">
      <div class="icon">📨</div>
      <h3>One‑tap reporting</h3>
      <p class="muted">Residents submit issues with photos, location, and timestamps in under a minute.</p>
    </article>
    <article class="card feature">
      <div class="icon">📊</div>
      <h3>Live tracking</h3>
      <p class="muted">Track status from <em>Reported</em> to <em>Resolved</em> with clear milestones.</p>
    </article>
    <article class="card feature">
      <div class="icon">🛡️</div>
      <h3>Secure & role‑based</h3>
      <p class="muted">Admin tools, audit logs, and best‑practice security to keep data safe.</p>
    </article>
  </div>
</section>
<!-- How it works -->
<section id="how" class="wrap section">
  <div class="grid-2">
    <div>
      <span class="kicker">How it works</span>
      <h2>Simple steps. Powerful results.</h2>
      <div class="list">
        <div class="row"><span class="badge">1</span> <div><strong>Submit</strong><br><span class="muted">Resident fills a quick form with details and optional photo.</span></div></div>
        <div class="row"><span class="badge">2</span> <div><strong>Track</strong><br><span class="muted">A tracking ID keeps everyone updated in real time.</span></div></div>
        <div class="row"><span class="badge">3</span> <div><strong>Resolve</strong><br><span class="muted">Teams act, update notes, and close with proof.</span></div></div>
      </div>
             <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
       </div>
    </div>
    <div class="card" style="padding:22px">
      <div class="muted">Uptime</div>
      <div style="font-size:2.4rem;font-weight:800;margin-top:6px">99.98%</div>
      <div class="muted" style="margin-top:18px">Monthly reports handled</div>
      <div style="font-size:2.4rem;font-weight:800;margin-top:6px;color:var(--ok)">10k+</div>
      <div class="muted" style="margin-top:18px">Avg time to first response</div>
      <div style="font-size:2.4rem;font-weight:800;margin-top:6px;color:var(--accent)">12m</div>
    </div>
  </div>
</section>
<!-- Testimonials (auto‑scroll) -->
<section class="wrap section">
  <div class="center">
    <span class="kicker">Loved by communities</span>
    <h2>What users are saying</h2>
  </div>
  <div class="marquee" id="marquee">
    <div class="card quote"><div class="stars">★★★★★</div><p>"Submitting a report took less than a minute. I could see progress the whole time."</p><small>— Resident, Brgy. 5‑A</small></div>
    <div class="card quote"><div class="stars">★★★★★</div><p>"Our team clears backlogs twice as fast thanks to the dashboard and status flows."</p><small>— Staff, City Office</small></div>
    <div class="card quote"><div class="stars">★★★★☆</div><p>"The tracking ID made follow‑ups painless. Super helpful."</p><small>— Resident, Brgy. 12‑B</small></div>
    <div class="card quote"><div class="stars">★★★★★</div><p>"Zero training needed. It just works."</p><small>— Barangay Captain</small></div>
  </div>
</section>

<!-- FAQ -->
<section id="faq" class="wrap section">
  <div class="center">
    <span class="kicker">FAQ</span>
    <h2>Answers to common questions</h2>
  </div>
  <div class="faq" style="margin-top:18px">
    <details>
      <summary>Can residents track their complaints?</summary>
      <p>Yes. Each submission generates a tracking ID that shows live status updates.</p>
    </details>
    <details>
      <summary>Does it work on mobile phones?</summary>
      <p>Absolutely—CMS is responsive and works on any modern device.</p>
    </details>
    <details>
      <summary>Can we export data?</summary>
      <p>Admins can export CSV and generate summary reports anytime.</p>
    </details>
  </div>
</section>
<!-- Get Started / Contact -->
<section id="get-started" class="wrap section cta">
  <div>
    <span class="kicker">Ready to try?</span>
    <h2>Launch your portal in minutes.</h2>
    <p class="muted">No setup fees. We'll guide you through connecting your existing workflow.</p>
         <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
     </div>
  </div>
  <form id="contact" class="card" style="padding:18px">
    <h3 style="margin:0 0 8px">Contact us</h3>
    <p class="muted" style="margin-top:0">We'll respond within 24 hours.</p>
    <div style="display:grid;gap:10px;margin-top:8px">
      <input name="name" placeholder="Full name" required aria-label="Full name"
             style="height:46px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0b1226;color:#fff;padding:0 12px;outline:none;box-shadow:none">
      <input name="email" type="email" placeholder="Email address" required aria-label="Email"
             style="height:46px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0b1226;color:#fff;padding:0 12px">
      <textarea name="msg" rows="4" placeholder="How can we help?" required aria-label="Message"
             style="border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0b1226;color:#fff;padding:10px 12px;resize:vertical"></textarea>
      <button class="btn" type="submit">Send message</button>
      <div id="contactNote" class="muted" role="status" aria-live="polite"></div>
    </div>
  </form>
</section>
<!-- Footer -->
<footer class="wrap footer">
     <div style="display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap">
     <div>© <span id="year"></span> CMS. All rights reserved.</div>
   </div>
</footer>
<!-- Place your script here, just before </body> -->
<script>
    // Smooth scroll helper
    function scrollToId(id){
      const el = document.getElementById(id);
      if(!el) return;
      const y = el.getBoundingClientRect().top + window.scrollY - 70;
      window.scrollTo({top:y, behavior:'smooth'});
    }
    // Mobile menu
    const menuBtn = document.getElementById('menuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    function toggleMenu(show){
      const isOpen = !mobileMenu.classList.contains('hidden');
      const next = (typeof show === 'boolean') ? show : !isOpen;
      mobileMenu.classList.toggle('hidden', !next);
      menuBtn.setAttribute('aria-expanded', String(next));
    }
    menuBtn.addEventListener('click', () => toggleMenu());
    // Simple marquee animation
    (function marquee(){
      const box = document.getElementById('marquee');
      let scrollX = 0;
      function step(){
        scrollX += 0.4;
        if (scrollX >= box.scrollWidth / 2) scrollX = 0;
        box.scrollLeft = scrollX;
        requestAnimationFrame(step);
      }
      // duplicate content for seamless loop
      box.innerHTML = box.innerHTML + box.innerHTML;
      step();
    })();
    // Contact form - functional with backend API
    document.querySelector('#contact').addEventListener('submit', async (e)=>{
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const name = formData.get('name');
      const email = formData.get('email');
      const msg = formData.get('msg');
      
      const note = document.getElementById('contactNote');
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      
      // Show loading state
      note.textContent = 'Sending...';
      submitBtn.textContent = 'Sending...';
      submitBtn.disabled = true;
      
      try {
        const response = await fetch('/api/contact/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            name: name,
            email: email,
            msg: msg
          })
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
          // Success
          e.target.reset();
          note.textContent = data.message;
          note.style.color = 'var(--ok)';
          
          // Show success notification
          showNotification(data.message, 'success');
        } else {
          // Error
          note.textContent = data.error || 'Failed to send message. Please try again.';
          note.style.color = 'var(--danger)';
          
          // Show error notification
          showNotification(data.error || 'Failed to send message. Please try again.', 'error');
        }
      } catch (error) {
        console.error('Contact form error:', error);
        note.textContent = 'Network error. Please try again.';
        note.style.color = 'var(--danger)';
        
        // Show error notification
        showNotification('Network error. Please try again.', 'error');
      } finally {
        // Reset button state
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    });
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();
    // Subtle link focus rings
    document.addEventListener('keydown', e=>{
      if(e.key === 'Tab'){ document.body.style.outline = '2px solid var(--ring)'; setTimeout(()=>document.body.style.outline='none',300)}
    });
    // Modal functionality
    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.remove('hidden');
        // Use setTimeout to ensure the modal is visible before adding the show class
        setTimeout(() => {
          modal.classList.add('show');
        }, 10);
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
        // Reset signup form fields when opening signup modal
        if (modalId === 'signupModal') {
          const signupForm = document.getElementById('signupForm');
          const nameField = signupForm.querySelector('#signupName').closest('.form-group');
          const systemActivationKeyField = signupForm.querySelector('#systemActivationKey')?.closest('.form-group');
          const adminAccessKeyField = signupForm.querySelector('#adminAccessKey')?.closest('.form-group');
          const adminMessage = signupForm.querySelector('#adminMessage');
          // Reset to user form by default
          nameField.style.display = 'block';
          if (systemActivationKeyField) {
            systemActivationKeyField.style.display = 'none';
          }
          if (adminAccessKeyField) {
            adminAccessKeyField.style.display = 'none';
          }
          if (adminMessage) {
            adminMessage.style.display = 'none';
          }
        }
      }
    }
    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.remove('show');
        setTimeout(() => {
          modal.classList.add('hidden');
        }, 300);
        document.body.style.overflow = ''; // Restore scrolling
      }
    }
    function switchModal(closeModalId, openModalId) {
      closeModal(closeModalId);
      setTimeout(() => {
        openModal(openModalId);
        // Reset role toggle to default (user) when switching modals
        if (openModalId === 'loginModal') {
          toggleRole('user', 'login');
        } else if (openModalId === 'signupModal') {
          toggleRole('user', 'signup');
        }
      }, 350);
    }
    // Notification Modal Functions
    function showNotification(message, type = 'success') {
      const modal = document.getElementById('notificationModal');
      const icon = document.getElementById('notificationIcon');
      const title = document.getElementById('notificationTitle');
      const messageEl = document.getElementById('notificationMessage');
      // Set content based on type
      if (type === 'success') {
        icon.textContent = '✅';
        title.textContent = 'Success';
        title.style.color = 'var(--ok)';
      } else if (type === 'error') {
        icon.textContent = '❌';
        title.textContent = 'Error';
        title.style.color = 'var(--danger)';
      } else if (type === 'info') {
        icon.textContent = 'ℹ️';
        title.textContent = 'Information';
        title.style.color = 'var(--brand)';
      }
      messageEl.textContent = message;
      // Show the notification
      openModal('notificationModal');
    }
    function closeNotification() {
      closeModal('notificationModal');
    }
    // Modals now only close via the X button
    // Removed automatic closing on outside click and Escape key
    // Handle form submissions
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const email = formData.get('email');
      const password = formData.get('password');
      const remember = formData.get('remember');
      const role = window.currentLoginRole || 'user';
      
      // Store login data for later use
      window.loginData = { email, password, remember, role };
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Sending...';
      submitBtn.disabled = true;
      
      try {
        if (role === 'user') {
          // User login - send to API
          const response = await fetch('/api/user/login/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: email,
              password: password
            })
          });
          
          const data = await response.json();
          
          if (data.success) {
            // Show OTP form for user login
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('loginOtpForm').classList.remove('hidden');
            
            const otpHeader = document.querySelector('#loginOtpForm .otp-header');
            const otpLabel = document.querySelector('label[for="loginOtpCode"]');
            const otpInput = document.getElementById('loginOtpCode');
            
            otpHeader.style.display = 'block';
            document.getElementById('loginOtpEmailDisplay').textContent = email;
            if (otpLabel) otpLabel.textContent = 'Verification Code';
            if (otpInput) {
              otpInput.placeholder = 'Enter 6-digit code';
              otpInput.setAttribute('inputmode','numeric');
              otpInput.setAttribute('pattern','[0-9]{6}');
            }
            
            // Hide role toggle during OTP verification
            document.querySelector('#loginModal .role-toggle').style.display = 'none';
            // Start OTP timer
            startLoginOTPTimer();
            
            showNotification(data.message, 'success');
          } else {
            showNotification(data.error || 'Login failed', 'error');
          }
        } else {
          // Admin login - send to API
          const response = await fetch('/api/admin/login/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: email,
              password: password
            })
          });

          const data = await response.json();

          if (data.success) {
            // Show access key form for admin (loginOtpForm is repurposed)
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('loginOtpForm').classList.remove('hidden');

            const otpHeader = document.querySelector('#loginOtpForm .otp-header');
            const otpLabel = document.querySelector('label[for="loginOtpCode"]');
            const otpInput = document.getElementById('loginOtpCode');

            if (otpHeader) {
              otpHeader.style.display = 'none'; // Hide OTP header for access key
            }
            if (otpLabel) otpLabel.textContent = '6-digit Admin Access Key';
            if (otpInput) {
              otpInput.placeholder = 'Enter 6-digit admin key';
              otpInput.setAttribute('inputmode','numeric');
              otpInput.setAttribute('pattern','[0-9]{6}');
            }

            // Hide role toggle during access key verification
            document.querySelector('#loginModal .role-toggle').style.display = 'none';

            showNotification(data.message, 'success');
          } else {
            showNotification(data.error || 'Login failed', 'error');
          }
        }
      } catch (error) {
        console.error('Login error:', error);
        showNotification('Network error. Please try again.', 'error');
      } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    });
    document.getElementById('signupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      // Also try to get values directly from form elements as backup
      const name = formData.get('name') || e.target.querySelector('#signupName')?.value || '';
      const email = formData.get('email') || e.target.querySelector('#signupEmail')?.value || '';
      const barangay = formData.get('barangay') || e.target.querySelector('#signupBarangay')?.value || '';
      const password = formData.get('password') || e.target.querySelector('#signupPassword')?.value || '';
      const confirmPassword = formData.get('confirmPassword') || e.target.querySelector('#signupConfirmPassword')?.value || '';
      const terms = formData.get('terms');
      const systemActivationKey = formData.get('systemActivationKey');
      const adminAccessKey = formData.get('adminAccessKey');
      const role = window.currentSignupRole || 'user';
      
      // Debug logging
      console.log('Form data collected:', { name, email, barangay, password: password ? '***' : 'empty', confirmPassword: confirmPassword ? '***' : 'empty', role, systemActivationKey: systemActivationKey ? '***' : 'empty', adminAccessKey: adminAccessKey ? '***' : 'empty' });
      
      // Validate required fields based on role
      if (role === 'admin') {
        // For admin, name field is hidden, so don't validate it
        if (!email || !barangay || !password || !confirmPassword) {
          showNotification('Please fill in all required fields', 'error');
          return;
        }
      } else {
        // For user, validate all fields including name
        if (!name || !email || !barangay || !password || !confirmPassword) {
          showNotification('Please fill in all required fields', 'error');
          return;
        }
      }
      
      // Validate passwords match
      if (password !== confirmPassword) {
        showNotification('Passwords do not match!', 'error');
        return;
      }
      
      // Additional validation for admin signup
      if (role === 'admin') {
        if (!systemActivationKey) {
          showNotification('Please enter the system activation key for admin signup.', 'error');
          return;
        }
        if (!adminAccessKey) {
          showNotification('Please enter the 6-digit admin access key.', 'error');
          return;
        }
        if (!adminAccessKey.match(/^\d{6}$/)) {
          showNotification('Admin access key must be exactly 6 digits.', 'error');
          return;
        }
        // In a real app, you would validate the system activation key against a database
        console.log('System activation key:', systemActivationKey);
        console.log('Admin access key:', adminAccessKey);
      }
      
      // Only proceed with user registration (not admin)
      if (role === 'user') {
        console.log('Proceeding with user registration for role:', role);
        console.log('Sending data to API:', { full_name: name, email, barangay, password: password ? '***' : 'empty', confirm_password: confirmPassword ? '***' : 'empty' });
        
        try {
          const response = await fetch('/api/user/send-verification/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              full_name: name,
              email: email,
              barangay: barangay,
              password: password,
              confirm_password: confirmPassword
            })
          });
          
          const data = await response.json();
          
          if (response.ok) {
      // Store signup data for later use
            window.signupData = { name, email, barangay, password, terms, role };
      // Show OTP form
      document.getElementById('signupForm').classList.add('hidden');
      document.getElementById('otpForm').classList.remove('hidden');
      document.getElementById('otpEmailDisplay').textContent = email;
      // Hide role toggle during OTP verification
      document.querySelector('#signupModal .role-toggle').style.display = 'none';
      // Start OTP timer
      startOTPTimer();
            showNotification(data.message, 'success');
          } else {
            console.log('API Error Response:', data);
            showNotification(data.error || 'Failed to send verification code', 'error');
          }
        } catch (error) {
          console.error('Error sending verification code:', error);
          showNotification('Network error. Please try again.', 'error');
        }
      } else {
        // For admin, use the new API flow
        console.log('Proceeding with admin registration for role:', role);
        console.log('Sending data to API:', { email, barangay, password: password ? '***' : 'empty', confirm_password: confirmPassword ? '***' : 'empty', activation_key: systemActivationKey, admin_access_key: adminAccessKey });
        
        try {
          const response = await fetch('/api/admin/send-verification/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: email,
              barangay: barangay,
              password: password,
              confirm_password: confirmPassword,
              activation_key: systemActivationKey,
              admin_access_key: adminAccessKey
            })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            // Store signup data for later use
            window.signupData = { email, barangay, password, terms, role, systemActivationKey, adminAccessKey };
            // Show OTP form
            document.getElementById('signupForm').classList.add('hidden');
            document.getElementById('otpForm').classList.remove('hidden');
            document.getElementById('otpEmailDisplay').textContent = email;
            // Hide role toggle during OTP verification
            document.querySelector('#signupModal .role-toggle').style.display = 'none';
            // Start OTP timer
            startOTPTimer();
            showNotification(data.message, 'success');
          } else {
            console.log('API Error Response:', data);
            showNotification(data.error || 'Failed to send verification code', 'error');
          }
        } catch (error) {
          console.error('Error sending verification code:', error);
          showNotification('Network error. Please try again.', 'error');
        }
      }
    });
    // OTP form submission
    document.getElementById('otpForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const otpCode = document.getElementById('otpCode').value;
      const role = window.currentSignupRole || 'user';
      
      // Only proceed with user verification (not admin)
      if (role === 'user') {
        try {
          const submitBtn = e.target.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent;
          submitBtn.textContent = 'Verifying...';
          submitBtn.disabled = true;
          
          const response = await fetch('/api/user/verify-email/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              full_name: window.signupData.name,
              email: window.signupData.email,
              barangay: window.signupData.barangay,
              password: window.signupData.password,
              otp_code: otpCode
            })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            submitBtn.textContent = 'Account Created!';
            setTimeout(() => {
              // Reset forms and close modal
              document.getElementById('signupForm').reset();
              document.getElementById('otpForm').reset();
              // Reset form field visibility after form reset
              const signupForm = document.getElementById('signupForm');
              const nameField = signupForm.querySelector('#signupName').closest('.form-group');
              const systemActivationKeyField = signupForm.querySelector('#systemActivationKey')?.closest('.form-group');
              const adminAccessKeyField = signupForm.querySelector('#adminAccessKey')?.closest('.form-group');
              const adminMessage = signupForm.querySelector('#adminMessage');
              // Reset to user form by default
              nameField.style.display = 'block';
              if (systemActivationKeyField) {
                systemActivationKeyField.style.display = 'none';
              }
              if (adminAccessKeyField) {
                adminAccessKeyField.style.display = 'none';
              }
              if (adminMessage) {
                adminMessage.style.display = 'none';
              }
              document.getElementById('signupForm').classList.remove('hidden');
              document.getElementById('otpForm').classList.add('hidden');
              // Show role toggle again
              document.querySelector('#signupModal .role-toggle').style.display = 'block';
              closeModal('signupModal');
              submitBtn.textContent = originalText;
              submitBtn.disabled = false;
              // Store user data in localStorage before clearing
              if (window.signupData) {
                localStorage.setItem('userData', JSON.stringify(window.signupData));
              }
              // Clear stored data
              delete window.signupData;
              console.log('Account created successfully as:', role);
              showNotification(data.message, 'success');
            }, 1000);
          } else {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
            showNotification(data.error || 'Invalid verification code', 'error');
            document.getElementById('otpCode').value = '';
            document.getElementById('otpCode').focus();
          }
        } catch (error) {
          console.error('Error verifying OTP:', error);
          const submitBtn = e.target.querySelector('button[type="submit"]');
          submitBtn.textContent = 'Verify & Create Account';
          submitBtn.disabled = false;
          showNotification('Network error. Please try again.', 'error');
        }
      } else {
        // For admin, use the new API flow
        try {
          const submitBtn = e.target.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent;
          submitBtn.textContent = 'Verifying...';
          submitBtn.disabled = true;
          
          const response = await fetch('/api/admin/verify-email/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: window.signupData.email,
              barangay: window.signupData.barangay,
              password: window.signupData.password,
              activation_key: window.signupData.systemActivationKey,
              admin_access_key: window.signupData.adminAccessKey,
              otp_code: otpCode
            })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            submitBtn.textContent = 'Account Created!';
            setTimeout(() => {
              // Reset forms and close modal
              document.getElementById('signupForm').reset();
              document.getElementById('otpForm').reset();
              // Reset form field visibility after form reset
              const signupForm = document.getElementById('signupForm');
              const nameField = signupForm.querySelector('#signupName').closest('.form-group');
              const systemActivationKeyField = signupForm.querySelector('#systemActivationKey')?.closest('.form-group');
              const adminAccessKeyField = signupForm.querySelector('#adminAccessKey')?.closest('.form-group');
              const adminMessage = signupForm.querySelector('#adminMessage');
              // Reset to user form by default
              nameField.style.display = 'block';
              if (systemActivationKeyField) {
                systemActivationKeyField.style.display = 'none';
              }
              if (adminAccessKeyField) {
                adminAccessKeyField.style.display = 'none';
              }
              if (adminMessage) {
                adminMessage.style.display = 'none';
              }
              document.getElementById('signupForm').classList.remove('hidden');
              document.getElementById('otpForm').classList.add('hidden');
              // Show role toggle again
              document.querySelector('#signupModal .role-toggle').style.display = 'block';
              closeModal('signupModal');
              submitBtn.textContent = originalText;
              submitBtn.disabled = false;
              // Clear stored data
              delete window.signupData;
              console.log('Admin account created successfully');
              showNotification(data.message, 'success');
            }, 1000);
          } else {
            console.log('API Error Response:', data);
            showNotification(data.error || 'Failed to verify email', 'error');
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
            document.getElementById('otpCode').value = '';
            document.getElementById('otpCode').focus();
          }
        } catch (error) {
          console.error('Error verifying OTP:', error);
          const submitBtn = e.target.querySelector('button[type="submit"]');
          submitBtn.textContent = 'Verify & Create Account';
          submitBtn.disabled = false;
          showNotification('Network error. Please try again.', 'error');
        }
      }
    });
    // Login OTP form submission
    document.getElementById('loginOtpForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const otpCode = document.getElementById('loginOtpCode').value;
      const role = window.currentLoginRole || 'user';
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Verifying...';
      submitBtn.disabled = true;
      
      try {
        if (role === 'user') {
          // User login OTP verification - send to API
          const response = await fetch('/api/user/verify-login-otp/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: window.loginData.email,
              otp_code: otpCode
            })
          });
          
          const data = await response.json();
          
          if (data.success) {
            // Login successful
            submitBtn.textContent = 'Login Successful!';
            
            // Store user data in localStorage
            const userData = {
              name: data.user.full_name,
              email: data.user.email,
              barangay: data.user.barangay,
              role: role
            };
            localStorage.setItem('userData', JSON.stringify(userData));
            
            // Reset forms and close modal
            document.getElementById('loginForm').reset();
            document.getElementById('loginOtpForm').reset();
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('loginOtpForm').classList.add('hidden');
            // Show role toggle again
            document.querySelector('#loginModal .role-toggle').style.display = 'block';
            closeModal('loginModal');
            
            // Clear stored data
            delete window.loginData;
            
            showNotification('Login successful! Redirecting to dashboard...', 'success');
            
            setTimeout(() => {
              // Redirect to user dashboard
              window.location.href = data.redirect || '/user.html';
            }, 1000);
          } else {
            showNotification(data.error || 'Invalid verification code', 'error');
            document.getElementById('loginOtpCode').value = '';
            document.getElementById('loginOtpCode').focus();
          }
        } else {
          // Admin login - verify access key with API
          const response = await fetch('/api/admin/verify-access-key/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: window.loginData.email,
              access_key: otpCode
            })
          });
          
          const data = await response.json();
          
          if (data.success) {
            // Login successful
            submitBtn.textContent = 'Login Successful!';
            
            // Store admin data in localStorage
            const adminData = {
              name: data.user.username,
              email: data.user.email,
              barangay: data.user.barangay,
              role: role
            };
            localStorage.setItem('userData', JSON.stringify(adminData));
            
            // Reset forms and close modal
            document.getElementById('loginForm').reset();
            document.getElementById('loginOtpForm').reset();
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('loginOtpForm').classList.add('hidden');
            // Show role toggle again
            document.querySelector('#loginModal .role-toggle').style.display = 'block';
            closeModal('loginModal');
            
            // Clear stored data
            delete window.loginData;
            
            showNotification('Admin login successful! Redirecting to dashboard...', 'success');
            
            setTimeout(() => {
              // Redirect to admin dashboard
              window.location.href = data.redirect || '/admin-dashboard.html';
            }, 1000);
          } else {
            showNotification(data.error || 'Invalid admin access key', 'error');
            document.getElementById('loginOtpCode').value = '';
            document.getElementById('loginOtpCode').focus();
          }
        }
      } catch (error) {
        console.error('Login OTP verification error:', error);
        showNotification('Network error. Please try again.', 'error');
      } finally {
        if (submitBtn.textContent !== 'Login Successful!') {
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        }
      }
    });
    // OTP Timer functionality
    let otpTimer;
    let otpTimeLeft = 60;
    function startOTPTimer() {
      otpTimeLeft = 60;
      const timerDisplay = document.getElementById('resendTimer');
      const resendBtn = document.querySelector('.otp-actions .btn:first-child');
      resendBtn.disabled = true;
      resendBtn.style.opacity = '0.5';
      otpTimer = setInterval(() => {
        otpTimeLeft--;
        timerDisplay.textContent = otpTimeLeft;
        if (otpTimeLeft <= 0) {
          clearInterval(otpTimer);
          resendBtn.disabled = false;
          resendBtn.style.opacity = '1';
          timerDisplay.textContent = '0';
        }
      }, 1000);
    }
    // Resend OTP function
    async function resendOTP() {
      if (otpTimeLeft > 0) return;
      
      if (window.signupData && window.signupData.role === 'user') {
        try {
          const response = await fetch('/api/user/resend-verification/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: window.signupData.email
            })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            showNotification(data.message, 'success');
            startOTPTimer();
          } else {
            showNotification(data.error || 'Failed to resend verification code', 'error');
          }
        } catch (error) {
          console.error('Error resending OTP:', error);
          showNotification('Network error. Please try again.', 'error');
        }
      } else if (window.signupData && window.signupData.role === 'admin') {
        // For admin, use the old demo flow
      console.log('OTP resent to:', window.signupData?.email);
      showNotification('Verification code resent to your email!', 'info');
      startOTPTimer();
      } else {
        showNotification('No signup data found. Please try signing up again.', 'error');
      }
    }
    // Change email function
    function changeEmail() {
      // Go back to signup form
      document.getElementById('otpForm').classList.add('hidden');
      document.getElementById('signupForm').classList.remove('hidden');
      // Show role toggle again
      document.querySelector('#signupModal .role-toggle').style.display = 'block';
      // Clear OTP form
      document.getElementById('otpForm').reset();
      // Stop timer
      if (otpTimer) {
        clearInterval(otpTimer);
      }
      // Reset timer display
      document.getElementById('resendTimer').textContent = '60';
      const resendBtn = document.querySelector('.otp-actions .btn:first-child');
      resendBtn.disabled = false;
      resendBtn.style.opacity = '1';
    }
    // Login OTP Timer functionality
    let loginOtpTimer;
    let loginOtpTimeLeft = 60;
    function startLoginOTPTimer() {
      loginOtpTimeLeft = 60;
      const timerDisplay = document.getElementById('loginResendTimer');
      const resendBtn = document.querySelector('.otp-actions .btn:first-child');
      resendBtn.disabled = true;
      resendBtn.style.opacity = '0.5';
      loginOtpTimer = setInterval(() => {
        loginOtpTimeLeft--;
        timerDisplay.textContent = loginOtpTimeLeft;
        if (loginOtpTimeLeft <= 0) {
          clearInterval(loginOtpTimer);
          resendBtn.disabled = false;
          resendBtn.style.opacity = '1';
          timerDisplay.textContent = '0';
        }
      }, 1000);
    }
    // Resend Login OTP function
    async function resendLoginOTP() {
      if (loginOtpTimeLeft > 0) return;
      
      const role = window.currentLoginRole || 'user';
      
      if (role === 'user' && window.loginData?.email) {
        try {
          const response = await fetch('/api/user/login/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: window.loginData.email,
              password: window.loginData.password
            })
          });
          
          const data = await response.json();
          
          if (data.success) {
            showNotification(data.message, 'success');
            startLoginOTPTimer();
          } else {
            showNotification(data.error || 'Failed to resend verification code', 'error');
          }
        } catch (error) {
          console.error('Resend login OTP error:', error);
          showNotification('Network error. Please try again.', 'error');
        }
      } else {
        // Admin resend - demo
        console.log('Admin login OTP resent to:', window.loginData?.email);
        showNotification('Verification code resent!', 'info');
        startLoginOTPTimer();
      }
    }
    // Change Login Email function
    function changeLoginEmail() {
      // Go back to login form
      document.getElementById('loginOtpForm').classList.add('hidden');
      document.getElementById('loginForm').classList.remove('hidden');
      // Show role toggle again
      document.querySelector('#loginModal .role-toggle').style.display = 'block';
      // Clear OTP form
      document.getElementById('loginOtpForm').reset();
      // Stop timer
      if (loginOtpTimer) {
        clearInterval(loginOtpTimer);
      }
      // Reset timer display
      document.getElementById('loginResendTimer').textContent = '60';
      const resendBtn = document.querySelector('.otp-actions .btn:first-child');
      resendBtn.disabled = false;
      resendBtn.style.opacity = '1';
    }
    // Role Toggle functionality
    function toggleRole(role, context) {
      window.currentLoginRole = role;
      if (context === 'login') {
        const loginSubmitBtn = document.getElementById('loginSubmitBtn') || document.querySelector('#loginForm button[type="submit"]');
        
        if (role === 'admin') {
          loginSubmitBtn.textContent = 'Proceed login';
        } else {
          loginSubmitBtn.textContent = 'Send Verification Code';
        }
      }
      // Update active state of toggle buttons
      const modal = document.getElementById(context + 'Modal');
      const toggleBtns = modal.querySelectorAll('.toggle-btn');
      toggleBtns.forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.role === role) {
          btn.classList.add('active');
        }
      });
      // Store the selected role for the current modal
      if (context === 'login') {
        window.currentLoginRole = role;
      } else {
        window.currentSignupRole = role;
      }
      // Update modal header to show selected role
      const header = modal.querySelector('.modal-header h2');
      if (context === 'login') {
        header.textContent = `Login as ${role.charAt(0).toUpperCase() + role.slice(1)}`;
      } else {
        header.textContent = `Sign Up as ${role.charAt(0).toUpperCase() + role.slice(1)}`;
      }
      // Handle Admin Sign-Up form field visibility
      if (context === 'signup') {
        const signupForm = document.getElementById('signupForm');
        const nameField = signupForm.querySelector('#signupName').closest('.form-group');
        const nameInput = signupForm.querySelector('#signupName');
        const systemActivationKeyField = signupForm.querySelector('#systemActivationKey')?.closest('.form-group');
        const adminAccessKeyField = signupForm.querySelector('#adminAccessKey')?.closest('.form-group');
        const adminMessage = signupForm.querySelector('#adminMessage');
        if (role === 'admin') {
          // Hide name field for admin
          nameField.style.display = 'none';
          if (nameInput) { nameInput.disabled = true; nameInput.removeAttribute('required'); }
          // Show system activation key field if it exists, or create it
          if (!systemActivationKeyField) {
            const confirmPasswordField = signupForm.querySelector('#signupConfirmPassword').closest('.form-group');
            const newSystemActivationKeyField = document.createElement('div');
            newSystemActivationKeyField.className = 'form-group';
            newSystemActivationKeyField.innerHTML = `
              <label for="systemActivationKey">System Activation Key</label>
              <input type="text" id="systemActivationKey" name="systemActivationKey" placeholder="Enter system key (e.g., F32024)" required>
            `;
            signupForm.insertBefore(newSystemActivationKeyField, confirmPasswordField.nextSibling);
          } else {
            systemActivationKeyField.style.display = 'block';
          }
          // Show admin message if it exists, or create it (must appear directly above System Activation Key)
          if (!adminMessage) {
            const confirmPasswordField = signupForm.querySelector('#signupConfirmPassword').closest('.form-group');
            const newAdminMessage = document.createElement('div');
            newAdminMessage.className = 'form-group';
            newAdminMessage.id = 'adminMessage';
            newAdminMessage.innerHTML = `
              <p>Enter the System Activation Key from your administrator.</p>
            `;
            // Insert now; it will sit above the system key after we add the access key below
            signupForm.insertBefore(newAdminMessage, confirmPasswordField.nextSibling);
          } else {
            adminMessage.style.display = 'block';
            // Update the message content for existing admin message
            adminMessage.querySelector('p').innerHTML = 'Enter the System Activation Key from your administrator.';
            // Ensure the message is positioned directly above the System Activation Key
            if (systemActivationKeyField && adminMessage.nextSibling !== systemActivationKeyField) {
              signupForm.insertBefore(adminMessage, systemActivationKeyField);
            }
          }
          // Show admin access key field if it exists, or create it
          if (!adminAccessKeyField) {
            const confirmPasswordField = signupForm.querySelector('#signupConfirmPassword').closest('.form-group');
            const newAdminAccessKeyField = document.createElement('div');
            newAdminAccessKeyField.className = 'form-group';
            newAdminAccessKeyField.innerHTML = `
              <label for="adminAccessKey">6-digit Admin Access Key (2FM)</label>
              <input type="text" id="adminAccessKey" name="adminAccessKey" maxlength="6" placeholder="Enter 6-digit key" pattern="[0-9]{6}" inputmode="numeric" required>
              <small class="muted">For admin 2-step verification; keep it private.</small>
            `;
            // Inserting last ensures this field appears above the message and system key
            signupForm.insertBefore(newAdminAccessKeyField, confirmPasswordField.nextSibling);
          } else {
            adminAccessKeyField.style.display = 'block';
            const adminAccessInput = adminAccessKeyField.querySelector('#adminAccessKey');
            if (adminAccessInput) { adminAccessInput.disabled = false; adminAccessInput.setAttribute('required',''); }
          }
        } else {
          // Show name field for user
          nameField.style.display = 'block';
          if (nameInput) { nameInput.disabled = false; nameInput.setAttribute('required',''); }
          // Hide activation key fields and admin message for user
          if (systemActivationKeyField) {
            systemActivationKeyField.style.display = 'none';
          }
          if (adminAccessKeyField) {
            adminAccessKeyField.style.display = 'none';
            const adminAccessInput = adminAccessKeyField.querySelector('#adminAccessKey');
            if (adminAccessInput) { adminAccessInput.disabled = true; adminAccessInput.removeAttribute('required'); }
          }
          if (adminMessage) {
            adminMessage.style.display = 'none';
          }
        }
      }
      console.log(`${context} role changed to:`, role);
      console.log('Current signup role:', window.currentSignupRole);
      console.log('Current login role:', window.currentLoginRole);
    }
    // Initialize default roles
    window.currentLoginRole = 'user';
    window.currentSignupRole = 'user';
    
    // Geolocation function for barangay detection
    async function locateBarangay() {
      const barangayInput = document.getElementById('signupBarangay');
      const locateBtn = document.getElementById('locateBarangayBtn');
      const locateBtnText = document.getElementById('locateBtnText');
      
      if (!barangayInput || !locateBtn || !locateBtnText) {
        showNotification('Error: Could not find barangay input field', 'error');
        return;
      }
      
      // Check if geolocation is supported
      if (!navigator.geolocation) {
        showNotification('Geolocation is not supported by your browser', 'error');
        return;
      }
      
      // Update button state
      locateBtn.disabled = true;
      locateBtnText.textContent = '📍 Locating...';
      
      try {
        // Get current position
        const position = await new Promise((resolve, reject) => {
          navigator.geolocation.getCurrentPosition(resolve, reject, {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 60000
          });
        });
        
        const { latitude, longitude } = position.coords;
        
        // Use reverse geocoding to get address
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&zoom=18&addressdetails=1`);
        
        if (!response.ok) {
          throw new Error('Failed to get address from coordinates');
        }
        
        const data = await response.json();
        
        // Extract barangay from address
        let barangay = '';
        
        // Try different possible fields for barangay
        if (data.address) {
          barangay = data.address.suburb || 
                    data.address.neighbourhood || 
                    data.address.city_district || 
                    data.address.district || 
                    data.address.quarter || 
                    data.address.residential || 
                    data.address.village || 
                    data.address.town || 
                    data.address.city || 
                    data.address.county || 
                    '';
        }
        
        if (!barangay) {
          // If no specific barangay found, use the display name
          barangay = data.display_name.split(',')[0] || 'Unknown Location';
        }
        
        // Update the input field
        barangayInput.value = barangay;
        
        // Show success notification
        showNotification(`Location detected: ${barangay}`, 'success');
        
        // Update button state
        locateBtnText.textContent = '✅ Located';
        setTimeout(() => {
          locateBtnText.textContent = '📍 Locate';
          locateBtn.disabled = false;
        }, 2000);
        
      } catch (error) {
        console.error('Geolocation error:', error);
        
        let errorMessage = 'Failed to detect your location';
        
        if (error.code === 1) {
          errorMessage = 'Location access denied. Please allow location access in your browser settings.';
        } else if (error.code === 2) {
          errorMessage = 'Location unavailable. Please check your device location settings.';
        } else if (error.code === 3) {
          errorMessage = 'Location request timed out. Please try again.';
        }
        
        showNotification(errorMessage, 'error');
        
        // Reset button state
        locateBtnText.textContent = '📍 Locate';
        locateBtn.disabled = false;
      }
    }
    // Check URL parameters on page load
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const showLogin = urlParams.get('show_login');
      
      if (showLogin === 'true') {
        // Show login modal automatically
        setTimeout(() => {
          openModal('loginModal');
          // Show a notification that authentication is required
          showNotification('Authentication required to access admin pages', 'info');
        }, 500);
      }
    });
  </script>
</body>
</html>

